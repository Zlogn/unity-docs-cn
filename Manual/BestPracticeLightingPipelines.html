<!DOCTYPE html><html class="no-js" lang="zh-cn">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-5V25JL6');
    </script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="twitter:card" content="summary">
<meta property="og:title" content="最佳实践：设置光照管线 - Unity 手册">
<title>最佳实践：设置光照管线 - Unity 手册</title>
<meta property="og:image" content="https://docs.unity3d.com/cn/2018.4/uploads/Main/BestPracticeLightingPipeline3.svg">
<meta name="description" content="首先，让我们来看看在本指南中经常遇到的几个重要图形渲染术语的定义。">
<meta property="og:description" content="首先，让我们来看看在本指南中经常遇到的几个重要图形渲染术语的定义。">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFiles/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836"></script><script type="text/javascript">
        function OptanonWrapper() { }
    </script><script>
      var docs_type = 'Manual';
      var lang = 'cn';
      var page = 'BestPracticeLightingPipelines';
      if(!page) page = 'index';
      var version = '2018.4';
      var docs_versions = [{version: '2021.1',version_string: '2021.1',supported: true},{version: '2020.2',version_string: '2020.2',supported: true},{version: '2020.1',version_string: '2020.1',supported: true},{version: '2019.4',version_string: '2019.4',supported: true},{version: '2019.3',version_string: '2019.3',supported: false},{version: '2019.2',version_string: '2019.2',supported: false},{version: '2019.1',version_string: '2019.1',supported: false},{version: '2018.4',version_string: '2018.4',supported: true},{version: '2018.3',version_string: '2018.3',supported: false},{version: '2018.2',version_string: '2018.2',supported: false},{version: '2018.1',version_string: '2018.1',supported: false},{version: '2017.4',version_string: '2017.4',supported: false},{version: '2017.3',version_string: '2017.3',supported: false},{version: '2017.2',version_string: '2017.2',supported: false},{version: '2017.1',version_string: '2017.1',supported: false},{version: '5.6',version_string: '560',supported: false},];</script><script type="text/javascript" src="../StaticFiles/js/jquery.js"></script><script type="text/javascript" src="../StaticFiles/js/core.js"></script><script type="text/javascript" src="../StaticFiles/js/jquery.sidebar.min.js"></script><script type="text/javascript" src="docdata/toc.js"></script><script type="text/javascript" src=""></script><script type="text/javascript" src="../StaticFiles/js/custom.js"></script><link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css">
<link rel="stylesheet" type="text/css" href="../StaticFiles/css/custom.css">
<link rel="canonical" href="https://docs.unity3d.com/cn/2018.4/Manual/BestPracticeLightingPipelines.html">
<link rel="alternate" href="https://docs.unity3d.com/en/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="en">
<link rel="alternate" href="https://docs.unity3d.com/cn/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="zh">
<link rel="alternate" href="https://docs.unity3d.com/ja/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="ja">
<link rel="alternate" href="https://docs.unity3d.com/es/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="es">
<link rel="alternate" href="https://docs.unity3d.com/kr/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="ko">
<link rel="alternate" href="https://docs.unity3d.com/ru/2018.4/Manual/BestPracticeLightingPipelines.html" hreflang="ru">
<link rel="alternate" href="https://docs.unity3d.com/2018.4/Documentation/Manual/BestPracticeLightingPipelines.html" hreflang="x-default">
</head>
<body>
<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5V25JL6" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a href="./index.html"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="搜索手册..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul class="menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">
                unity3d.com
              </a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2018.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/BestPracticeLightingPipelines.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/BestPracticeLightingPipelines.html">2020.2</a></li>
<li class="supported"><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/BestPracticeLightingPipelines.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/BestPracticeLightingPipelines.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/BestPracticeLightingPipelines.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/BestPracticeLightingPipelines.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/BestPracticeLightingPipelines.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/BestPracticeLightingPipelines.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/BestPracticeLightingPipelines.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/BestPracticeLightingPipelines.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/BestPracticeLightingPipelines.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/BestPracticeLightingPipelines.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/BestPracticeLightingPipelines.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/BestPracticeLightingPipelines.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/BestPracticeLightingPipelines.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/BestPracticeLightingPipelines.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p></p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p></p></li></div>
</ul>
<ul class="description">
<li><div class="supported-box"></div></li>
<li><div class="legacy-box"></div></li>
</ul>
</div>
</div>
<ul class="nav-menu-items">
<li class="menu-item"><a href="../Manual/index.html" class="selected">手册</a></li>
<li class="menu-item"><a href="../ScriptReference/index.html" class="">脚本 API</a></li>
</ul>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">语言:
        <span class="b">中文</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a data-lang="en" href="/2018.4/Documentation/Manual/BestPracticeLightingPipelines.html">English</a></li>
<li><a data-lang="cn" href="/cn/2018.4/Manual/BestPracticeLightingPipelines.html">中文</a></li>
<li><a data-lang="ja" href="/ja/2018.4/Manual/BestPracticeLightingPipelines.html">日本語</a></li>
<li><a data-lang="es" href="/es/2018.4/Manual/BestPracticeLightingPipelines.html">Español</a></li>
<li><a data-lang="kr" href="/kr/2018.4/Manual/BestPracticeLightingPipelines.html">한국어</a></li>
<li><a data-lang="ru" href="/ru/2018.4/Manual/BestPracticeLightingPipelines.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar hidden"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc">
<h2>手册</h2>
<div class="version-switcher">
<div class="current toggle" data-target=".version-list"><div class="version-number">
<div class="d-inline-block">
          Version:
          <b>2018.4</b>
</div>
<div class="d-inline-block arrow"></div>
</div></div>
<div class="version-list" style="display:none;">
<ul class="versions">
<li class="supported"><a class="docs_version_url_2021.1" href="/cn/2021.1/Manual/BestPracticeLightingPipelines.html">2021.1</a></li>
<li class="supported"><a class="docs_version_url_2020.2" href="/cn/2020.2/Manual/BestPracticeLightingPipelines.html">2020.2</a></li>
<li class="supported"><a class="docs_version_url_2020.1" href="/cn/2020.1/Manual/BestPracticeLightingPipelines.html">2020.1</a></li>
<li class="supported"><a class="docs_version_url_2019.4" href="/cn/2019.4/Manual/BestPracticeLightingPipelines.html">2019.4</a></li>
<li class=""><a class="docs_version_url_2019.3" href="/cn/2019.3/Manual/BestPracticeLightingPipelines.html">2019.3</a></li>
<li class=""><a class="docs_version_url_2019.2" href="/cn/2019.2/Manual/BestPracticeLightingPipelines.html">2019.2</a></li>
<li class=""><a class="docs_version_url_2019.1" href="/cn/2019.1/Manual/BestPracticeLightingPipelines.html">2019.1</a></li>
<li class="supported"><a class="docs_version_url_2018.4" href="/cn/2018.4/Manual/BestPracticeLightingPipelines.html">2018.4</a></li>
<li class=""><a class="docs_version_url_2018.3" href="/cn/2018.3/Manual/BestPracticeLightingPipelines.html">2018.3</a></li>
<li class=""><a class="docs_version_url_2018.2" href="/cn/2018.2/Manual/BestPracticeLightingPipelines.html">2018.2</a></li>
<li class=""><a class="docs_version_url_2018.1" href="/cn/2018.1/Manual/BestPracticeLightingPipelines.html">2018.1</a></li>
<li class=""><a class="docs_version_url_2017.4" href="/cn/2017.4/Manual/BestPracticeLightingPipelines.html">2017.4</a></li>
<li class=""><a class="docs_version_url_2017.3" href="/cn/2017.3/Manual/BestPracticeLightingPipelines.html">2017.3</a></li>
<li class=""><a class="docs_version_url_2017.2" href="/cn/2017.2/Manual/BestPracticeLightingPipelines.html">2017.2</a></li>
<li class=""><a class="docs_version_url_2017.1" href="/cn/2017.1/Manual/BestPracticeLightingPipelines.html">2017.1</a></li>
<li class=""><a class="docs_version_url_560" href="/cn/560/Manual/BestPracticeLightingPipelines.html">5.6</a></li>
<div class="versionsWithThisPage" style="display:none;"><li><p></p></li></div>
<div class="versionsWithoutThisPage" style="display:none;"><li><p></p></li></div>
</ul>
<ul class="description">
<li><div class="supported-box"></div></li>
<li><div class="legacy-box"></div></li>
</ul>
</div>
</div>
<div class="clear"></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap opened-sidebar"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity 用户手册 (2018.4)</a></li>
<li><a href="BestPracticeGuides.html">最佳实践指南</a></li>
<li>最佳实践：设置光照管线</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeMakingBelievableVisuals9.html"></a></span><div class="tip">动态光照</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ExpertGuides.html"></a></span><div class="tip">专家指南</div>
</div>
</div></div>
<h1>最佳实践：设置光照管线</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<h2>定义</h2>

<p>首先，让我们来看看在本指南中经常遇到的几个重要图形渲染术语的定义。</p>

<ul>
<li>
<strong>渲染管线</strong>确定场景中对象的显示方式，分为三个主要阶段。

<ul>
<li>第一步是<strong>剔除</strong>；它列出了需要渲染的对象，最好是那些对摄像机可见的对象（视锥体剔除）和其他对象不遮挡的对象（<a href="https://docs.unity3d.com/Manual/OcclusionCulling.html">遮挡剔除</a>）。</li>
<li>第二个阶段<strong>渲染</strong>是指将这些对象绘制到基于像素的缓冲区中（通过正确的光照以及它们的一些属性）。</li>
<li>最后，可以在这些缓冲区上执行<strong>后期处理</strong>操作，例如，应用颜色分级、泛光和景深，从而生成发送到显示设备的最终输出帧。根据帧率，这些操作每秒钟重复很多次。
<img src="../uploads/Main/BestPracticeLightingPipeline3.svg" alt="">
</li>
</ul>
</li>
<li><p><strong>着色器</strong>是在图形处理单元 (GPU) 上运行的程序或程序集合的通用名称。例如，在剔除阶段完成后，顶点着色器用于将可见对象的顶点坐标从“对象空间”转换为称为“裁剪空间”的不同空间；然后 GPU 使用这些新的坐标对场景进行光栅化，也就是将场景的矢量表示转换为实际像素。在稍后阶段，这些像素将由像素（或片元）着色器进行着色；像素颜色通常将取决于各自表面的材质属性以及周围的光照。现代硬件上另一种常见的着色器是<strong>计算着色器</strong>：计算着色器允许程序员利用 GPU 的大量并行处理能力，用于任何类型的数学运算，如光照剔除、粒子物理或体积模拟。</p></li>
<li>
<strong>直接光照</strong>指的是从自发光光源（如灯泡）发出的光照，而不是光从表面反射的结果。根据光源的大小及其与接收者的距离，这种光照通常会产生清晰的不同阴影。

<ul>
<li>请勿将直接光照与<strong>方向光照</strong>混淆，后者是指是由无限远的光源（例如计算机模拟的太阳）发出的光。方向光的显著特性是能够用平行光线覆盖整个场景，并且不存在距离衰减（或光衰减）；也就是说，接收到的光照量不会随着与光源距离的增加而衰减。</li>
<li>在现实中，太阳光也会像任何其他光源一样，光照会按照距离的平方反比定律而衰减。简单来说，当接收者与光源之间的距离增加时，收到光照量会迅速降低。例如，水星上的太阳光照度几乎是地球上的 <a href="https://www.nasa.gov/audience/foreducators/9-12/features/F_How_Far_How_Faint.html">7 倍</a>，火星上的太阳光照度是地球的近一半，而冥王星仅仅为 0.06%。然而，对于海拔高度范围非常有限的大多数实时应用程序来说，太阳光的衰减微不足道。因此，方向光完全足以模拟大多数 Unity 场景（包括以行星为中心的大型空旷空间）中的太阳光。对于其他类型的光源（如点光源和聚光灯），当您选择高清渲染管线时，Unity 现在可提供基于物理的衰减。</li>
</ul>
</li>
<li><p><strong>间接光照</strong>是由于光从表面反射并通过介质（如大气或半透明物质）传播和散射而形成的结果。在这种状况下，遮挡物通常投射出柔和甚至难以看清的阴影。</p></li>
<li>
<strong>全局光照 (GI)</strong> 用于在场景中生成间接光照，主要作为直接光照的函数。GI 有几种方法，如烘焙/动态光照贴图、辐照度体积、光传播体积、烘焙/动态光照探针、基于体素的 GI 和基于距离场的 GI。Unity 支持开箱即用的烘焙/动态光照贴图和光照探针。

<ul>
<li>
<strong>光照贴图程序</strong>是一个基础系统，它通过发射光线、计算光线反弹并将产生的光线应用到纹理来生成光照贴图和光照探针的数据。因此，不同的光照贴图程序通常会产生不同的光照外观，因为它们可能依赖不同的技术来生成光照数据。目前，Unity 提供两个光照贴图程序：Enlighten 和 Progressive Lightmapper（渐进光照贴图程序）。有关 GI 系统及其光照贴图程序的更多详细信息将在本指南的下一节中提供。</li>
</ul>
</li>
</ul>

<h2>概述</h2>

<p>下面的流程图从内容创建者的角度，大致显示了 Unity 中的整个光照管线。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline15.svg" alt="">
</figure>

<p>首先要选择一个渲染管线。然后决定如何产生间接光照，并相应地选择一个全局光照系统。确保为您的项目适当地调整了所有全局光照设置之后，您可以继续添加<a href="https://docs.unity3d.com/Manual/Lighting.html">光源</a>、<a href="https://docs.unity3d.com/Manual/StandardShaderMaterialParameterEmission.html">发光表面</a>、<a href="https://docs.unity3d.com/Manual/class-ReflectionProbe.html">反射探针</a>、<a href="https://docs.unity3d.com/Manual/LightProbes.html">光照探针</a>和<a href="https://docs.unity3d.com/Manual/class-LightProbeProxyVolume.html">光照探针代理体 (LPPV)</a>。所有这些光照对象的用法和特性的详细介绍超出了本文的范围，因此，建议您阅读手册中的“光照”部分，以学习如何在项目中正确地使用光照。</p>

<h2>渲染管线</h2>

<p>截至 2018 年初时，Unity 只有一条渲染管线可用；此管线已重命名为“内置渲染管线”(Built-In Render Pipeline)。此渲染器提供了前向渲染和延迟渲染以供选择。</p>

<ul>
<li>在（多通道）前向模式中，场景中的所有对象都是按顺序渲染，根据影响每个对象的光源数量，可能在多个通道中渲染，因此当对象被多个光源照亮时，渲染成本会急剧增加。这种类型的渲染器通常提供各种各样的着色器，并且可以很轻松地处理透明度。</li>
<li>在延迟模式下，所有（不透明）几何体首先渲染到缓冲区中，在其中存储有关材质的信息（颜色、镜面反射、光滑度等等）。在后一种通道（也就是“延迟”）中，每个像素按顺序着色：渲染时间将主要取决于影响每个像素的光源数量。对于透明对象以及某些包含复杂着色器的对象，仍然需要额外的前向渲染通道。当处理包含许多动态光源的场景时（例如具有人工光照的内部空间，或室外与室内光照相结合的项目），通常建议使用延迟渲染。</li>
</ul>

<p>2018 年 1 月，我们推出了可编程渲染管线 (SRP)，允许通过 C# 脚本来自定义渲染循环。这实际上是游戏引擎领域的一次小革命：用户终于无需使用像 C++ 这样的低级编程语言便可以个性化设置对象剔除、绘制和帧后期处理。</p>

<p>Unity 目前提供了两个预览版 SRP，它们的设计考虑到了性能和现代硬件：</p>

<ul>
<li>高清渲染管线 (HDRP) 是一种混合延迟/前向瓦片/聚类渲染器。它提供了先进的渲染和着色功能，是专为要求逼真视觉的 PC 和游戏主机项目而设计。</li>
</ul>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline6.svg" alt="">
</figure>

<p>瓦片是帧的一个小型二维方形像素部分，而聚类则是摄像机视锥体中的一个三维体积。瓦片和聚类渲染技术都依赖于影响每个瓦片和聚类的光源的列表，然后可以用相应的已知光源列表在一个通道中计算其光照。不透明对象很可能使用瓦片系统进行着色，而透明对象则依赖于聚类系统。该渲染器的主要优点是，与内置渲染管线（延迟）相比，光照处理速度更快，带宽消耗也大大减少，因为内置渲染管线依赖于更慢的多通道光照积累。</p>

<ul>
<li>轻量级渲染管线 (LWRP) 是一种快速的单通道前向渲染器；它是为实时光照要求较低的设备而设计的，例如智能手机、平板电脑和 XR 设备。轻量级渲染管线根据每个对象来剔除光线，并允许在单个通道中计算光照，与内置渲染管线相比，这会降低绘制调用次数。</li>
</ul>

<p>现在，您可以使用下面的决策图表来快速确认您应该根据几个关键标准选择哪一种渲染管线。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline16.svg" alt="">
</figure>

<h3>模板</h3>

<p>可以通过 Unity Package Manager (Window &gt; Package Manager) 来下载最新版本的 HDRP 和 LWRP。要使用这些 SRP 的其中之一，最简单的方法是使用 <a href="https://docs.unity3d.com/Manual/GettingStartedInstallingHub.html">Unity Hub</a> 来创建一个新项目并使用其中一个对应的模板。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline10.png" alt="">
</figure>

<h3>手动步骤</h3>

<p>如果要为项目手动设置 HDRP 或 LWRP，请确保安装了所需的包。然后在 Project 窗口中通过 Create &gt; Rendering &gt; High Definition Render Pipeline Asset 来创建一个新资源。将此资源拖动到 <a href="class-GraphicsSettings.html">Graphics</a> 设置中。如果选择了 HDRP，请确保在平台的 <strong>Player</strong> 设置中选择线性颜色空间，并在场景中添加 Rendering &gt; Scene Settings 对象。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipelineGif.gif" alt="">
</figure>

<p>如果在 <a href="class-GraphicsSettings.html">Graphics</a> Project Settings 窗口中没有分配任何管线资源，则 Unity 将使用默认的内置渲染管线 (Built-In Render Pipeline)。</p>

<h3>可扩展性</h3>

<p>如果您略懂渲染方面的知识，并且熟悉 C#，在您需要为项目完全定制渲染器时，我们绝对推荐使用 SRP 概念来创建您自己的自定义可编程渲染管线。因为 LWRP 的着色器库较小并且能够轻松注入、删除和交换渲染通道，因此可以对 LWRP 进行轻松扩展。</p>

<h3>兼容性</h3>

<p>在 Unity 中将项目的材质从内置渲染管线移植到 HDRP 或 LWRP 相对比较容易，这要归功于 Edit &gt; Render Pipeline &gt; Upgrade… 下的一键材质转换器。然而，请注意，这种操作是不可逆的。强烈建议提前备份您的项目！</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline9.png" alt="">
</figure>

<p>尽管如此，必须手动移植自定义着色器，因此在生产过程中从内置渲染管线过渡到 HDRP 或 LWRP 可能会耗费时间，具体时间取决于必须重新编写的自定义着色器数量。</p>

<p>此外，由于高清渲染管线在物理上比内置渲染管线更正确，特别是在光衰减和分布方面，因此在切换到 HDRP 之后，项目应该会有所不同。</p>

<p>此外，HDRP 和 LWRP 并不是交叉兼容的，因为它们没有共同的渲染特征。可以将项目从 HDRP 移植到 LWRP，反过来也可以，但并不是一键操作，而是需要手动重新制作光照、材质和着色器！</p>

<p>最后，HDRP 和 LWRP 仍然是预览版，Unity 正在努力确保这两个功能尽快可供生产阶段使用。请注意，这两个管线尚未实现所有功能。例如，下面详述的某些光照模式尚未完全适用于 LWRP，XR 还没有得到 HDRP 的正确支持。</p>

<h2>全局光照系统</h2>

<p>Unity 中有两个全局光照系统。可以在 Window &gt; Rendering &gt; Lighting Settings 中启用它们。</p>

<p>1.（预计算）实时全局光照：这个系统完全依赖于第三方光照中间件 <a href="https://docs.unity3d.com/Manual/GI-Enlighten.html">Enlighten</a>。在 Unity 中的预计算期间，Enlighten 经历两个漫长的阶段：聚类和光线传输。第一个阶段是将场景简化为一组称为聚类的面片，第二个阶段是计算这些聚类之间的可见性。在运行时，这些预计算的数据用于以交互方式生成间接光照。Enlighten 的强大功能依赖于实时编辑光照的能力，因为预计算的数据依赖于聚类间的关系。然而，与其他传统的光照贴图技术一样，编辑场景中的静态几何体将触发新的预计算。</p>

<p>2.烘焙全局光照：光照被烘焙成称为光照贴图的纹理以及光照探针。烘焙 GI 系统可以使用下列其中一个光照贴图程序：</p>

<pre><code>1.[渐进光照贴图程序 (Progressive Lightmapper)](https://docs.unity3d.com/Manual/ProgressiveLightmapper.html)
2.[Enlighten](https://docs.unity3d.com/Manual/GI-Enlighten.html)
</code></pre>

<p>渐进光照贴图程序可以优先计算摄像机视野内对象的光照，并大大加快光照的迭代速度，而代价是增加整个场景的整体烘焙时间。渐进光照贴图程序使用 CPU 根据路径追踪来计算间接光照。一种新的 <a href="https://www.youtube.com/watch?v=cRFwzf4BHvA">GPU 渐进光照贴图程序</a>目前正在开发中，这将极大降低场景的烘焙时间。</p>

<p>因为 Enlighten 和渐进光照贴图程序使用不同的方法产生烘焙光照，因此在比较这两者时，不应该期望得到完全匹配的光照效果。</p>

<p>请查看下面的图表，确定项目适合使用哪种全局光照系统，以及该系统的主要优点和缺点</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline4.svg" alt="">
</figure>

<h3>静态与动态对比</h3>

<p>无论使用哪种全局光照系统，在烘焙/预计算光照过程中，Unity 只会考虑标记为“Lightmap Static”的对象。动态（即非静态）对象必须依赖于放置在整个场景中的光照探针来获得间接光照。</p>

<p>由于光照的烘焙/预计算是一个相对缓慢的过程，所以只有具有不同光照变化（例如凹度和自我阴影）的大型和复杂资源才应被标记为“Lightmap Static”。获得均匀光照的较小和凸面网格不应标记为静态，因此它们应该从<a href="https://docs.unity3d.com/Manual/LightProbes.html">光照探针</a>获得间接光照；光照探针中存储了更简单的光照近似值。较大的动态对象可以依赖 <a href="https://docs.unity3d.com/Manual/class-LightProbeProxyVolume.html">LPPV</a>，以便获得更好的本地化间接光照。要最大程度减少烘焙时间并同时保持足够的光照质量，最重要的就是限制场景中标记为“Lightmap Static”的对象数量。可在本<a href="https://unity3d.com/learn/tutorials/topics/graphics/introduction-precomputed-realtime-gi?playlist=17102">教程</a>中详细了解这个优化过程和探针光照的重要性。</p>

<h3>警告</h3>

<p>Unity 允许烘焙和实时 GI 系统同时有效，因此可以访问所有光照功能。但是，务必注意，同时启用这两个系统会大大增加运行时的烘焙时间和内存使用量，因为这些系统不依赖相同的数据集。此外，在运行时对间接光照的交互式更新将给 CPU 带来更大的压力，而且在视觉上比较烘焙和实时 GI 系统提供的间接光照时，应该会看到差异，因为它们依赖不同的技术来模拟间接光照，并且通常以明显不同的分辨率运行。</p>

<p>同时使用这两个 GI 系统应仅限于高端平台和/或以可预测的成本对场景进行严格控制的项目。这种方法只应由非常了解所有光照设置的专家用户使用，因为同时管理这两个系统会增加很大的复杂性。所以，对大多数项目来说，选择两个 GI 系统的其中一个通常是更安全的策略。很少推荐同时使用这两个系统！</p>

<h2>光照模式</h2>

<p>光源的模式是一种常常让人混淆的属性。最重要的是，只有启用了烘焙全局光照系统时，光源的模式才有意义。</p>

<p>Light Inspector 中提供了三种可用模式：</p>

<p>1.烘焙：从这些光源产生的直接和间接光照被烘焙成光照贴图，这可能是一个耗时的过程。处理这些光源不需要运行时成本，但是将所产生的光照贴图应用到场景中确实需要很小的成本。
2.实时：来自这些光源的直接光照和阴影是实时的，因此不会被烘焙成光照贴图。它们的运行成本可能很高，具体取决于场景的复杂性、阴影投射光源的数量、重叠光源的数量等。此外，如果启用实时全局光照，则会在运行时更新间接光照，从而导致性能进一步降低。
3.混合：这种混合模式提供烘焙和实时功能（如烘焙间接光照和实时直接光照）的混合。场景中所有混合光源的行为及其性能影响将取决于所选择的全局混合光照模式（如下一节中所述）。</p>

<p>如果不使用任何 GI 系统或只使用实时 GI 系统，那么所有烘焙和混合光源都将被覆盖为实时光源！</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline7.svg" alt="">
</figure>

<p>下面的图表结合了一个决策流程图和一个比较表；可以帮助您决定每次在场景中添加新光源时哪种光源模式合适。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline12.svg" alt="">
</figure>

<h3>混合光照模式</h3>

<p>如前面的图表中所示，混合光源具有特定的烘焙和实时功能，具体取决于您在 Lighting &gt; Settings 窗口中选择的全局混合光照模式。</p>

<p>有四种模式可供选择：</p>

<p>1.Subtractive
2.Baked Indirect
3.Shadowmask Mode: Shadowmask
4.Shadowmask Mode: Distance Shadowmask</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline5.svg" alt="">
</figure>

<p>可以在 <strong>Edit</strong> &gt; <strong>Settings</strong> &gt; <strong>Quality</strong> 下面调整阴影遮罩模式 (Shadowmask mode) 和阴影距离 (Shadow Distance)。使用 HDRP 时，在 <strong>Graphics</strong> 设置中分配的 HDRenderPipelineAsset 中会启用阴影遮罩模式 (Shadowmask mode)，而阴影 Max Distance 是在 Scene Settings 对象中设置的。</p>

<p>HDRP 支持新的混合阴影遮罩模式。可以通过 Additional Settings 中的 Non Lightmapped Only 复选框来控制某个特定光源是否应投射实时阴影。如果使用这个参数，那么当摄像机在光源的 Fade Distance 值范围内时，光源会实时投射动态阴影，否则会回退到烘焙的阴影遮罩。这种新的 HDRP 模式的主要优点是能够针对特定光源（位于主方向光使用的 Shadow Distance 值范围内）使用烘焙的阴影遮罩，而不是实时阴影。</p>

<h2>管线比较表</h2>

<p>LWRP 和 HDRP 仍然处于预览版，这意味着它们一方面带来了令人兴奋的新特性，但另一方面，它们可能还不支持内置管线提供的某些功能，或者去除了对其他功能的支持。下表概述了 Unity 2018.3 的光照管线的当前状态。</p>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline8.svg" alt="">
</figure>

<h2>光照情形</h2>

<p>我们已经介绍了渲染管线和主要光照功能，现在让我们看看几个项目的例子，看看可以使用哪些设置来提供光照。由于每个项目都是独一无二的，因此您可能会根据自己的需求使用稍微不同的选项。</p>

<h3>1.原型构建或快速预先可视化</h3>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline1.svg" alt="">
</figure>

<p>如果您严重依赖 Asset Store 来构建原型，则内置渲染管线可能是唯一合适的渲染管线，因为商店中的大多数资源并不完全兼容 HDRP 和 LWRP；尽管如此，资源兼容性将随着时间推移而改善。如果您要从头开始构建所有资源，并且已经清楚了解了自己项目的需求，那么您可以从这两个 SRP（即 LWRP 或 HDRP）中选择一个，或者创建一个自定义 SRP。</p>

<p>如果处于（预）生产的早期阶段，并且需要快速周转时间和最大的光照灵活性，您可能更想要使用一种不需要任何预计算的完全实时方法，因此您可能希望同时关闭烘焙和实时 GI 系统。为了缓解缺少正确间接光照的问题，您可以从 <a href="https://github.com/Unity-Technologies/PostProcessing">Post Processing Stack V2</a> 启用屏幕空间环境光遮挡 (Screen Space Ambient Occlusion)：该功能可以提供低成本的实时接触阴影，从而帮助场景中的对象上底色。</p>

<h3>2.3D 手机策略游戏</h3>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline13.svg" alt="">
</figure>

<p>如果目标平台是移动设备，LWRP 可能是很好的候选项，可确保策略游戏的扎实性能。如果需要自定义渲染管线以更好地适应游戏，图形开发程序员可能会发现，扩展 LWRP 会更加简单明了。</p>

<p>如果选择 LWRP 并且使用烘焙全局光照，请注意，目前混合光源只能使用减法光照模式 (Subtractive Lighting Mode)。以后的版本中将增加对烘焙间接光照 (Baked Indirect) 和阴影遮罩 (Shadowmask) 的支持。</p>

<p>或者，如果您决定坚持使用旧的内置渲染管线，例如，由于您依赖 Asset Store 中的许多资源，那么所有全局混合光照模式都受支持。在这种情况下，采用阴影遮罩光照模式 (Shadowmask Lighting Mode) 的方法将提供烘焙阴影，同时仍然允许动态对象投射实时阴影。如果阴影遮罩对您的项目来说成本过高，则可以回退到最低成本的 Subtractive 模式。最后一点，如果关卡中有非常少的光源，且目标平台采用旧硬件，那么前向渲染路径可能是最好的选择。</p>

<h3>3.AAA 级走廊射击游戏（一天中的固定时间）</h3>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline14.svg" alt="">
</figure>

<p>如果目标是在 PC 和游戏主机上实现线性第一人称射击游戏的 AAA 级质量视觉效果，HDRP 应该是首选的渲染管线。同样，还可以在图形开发程序员的帮助下开发自定义 SRP。</p>

<p>如果关卡包含许多投射实时阴影的光源（例如，可破坏的灯光道具和移动光源），那么应该将烘焙 GI 系统与 Baked Indirect 模式配合使用，这样可以确保混合方向光和静态灯光道具中的烘焙光源呈现出良好的间接光照效果。如果关卡中大部分都是投射固定阴影的光源，那么推荐使用阴影遮罩的方法，因为 HDRP 提供了一个很好的混合阴影遮罩模式，允许更精细地控制实时阴影和烘焙阴影之间的混合。</p>

<p>因为这类线性游戏在性能和内存消耗方面通常是高度可预测的，所以烘焙和实时 GI 系统可以同时被激活。但是，正如<a href="https://docs.google.com/document/d/1eEhL5VvQb1AhoQQaK_DIQBVKjo1ETAB8HtxbgPV7b2o/edit#heading=h.joffqn5j7ada">全局光照部分</a>中所介绍的，同时使用这两个系统将极大增加性能成本和烘焙时间，而且只应由了解所有技术含义的专家用户使用！</p>

<h3>4.大逃杀游戏（昼夜周期）</h3>

<figure>
<img src="../uploads/Main/BestPracticeLightingPipeline11.svg" alt="">
</figure>

<p>如果您计划发布一款面向 PC 和游戏主机的大逃杀类型游戏（特征是包含大规模环境和完全动态光照），那么应该选择 HDRP，或者进行扩展以便为项目量身定制渲染管线。如果目标不是实现 AAA 级逼真视觉效果，而是面向低规格的移动设备或系统，那么可以考虑使用 LWRP。</p>

<p>为了适应昼夜周期，如果选择了 HDRP，实时 GI 系统应该被激活，因此可以模拟一天中任何时候的间接光照。对于某些光照密集型内部空间，如果希望让实时 GI 系统忽略这些内部空间，并将它们的渲染成本降到最低，您可以将某些光源的 Indirect Multiplier 属性设置为 0，从而在这些空间中最大限度提高性能。</p>

<p>LWRP 不支持实时全局光照系统：必须使用自定义脚本来处理昼夜周期，例如，通过脚本调节一天中的太阳和环境颜色。</p>

<p>对于这个特定的场景，不建议同时激活实时 GI 系统和烘焙 GI 系统，因为对于庞大的关卡，性能和场景管理方面产生的开销可能至关重要。反对同时使用这两个 GI 系统的另一个理由是，这样大规模的多人游戏存在着不可预知性：例如，性能估算要远远难于高度可编程的单人冒险游戏。</p>

<h2>结束语</h2>

<p>由于引入了可编程渲染管线，Unity 中的渲染架构在过去的几个月中发生了翻天覆地的变化。因此，要弄清楚所有这些变化及其对光照管线的影响可能会令人筋疲力尽。</p>

<p>希望本指南和及其多个插图能让您更好地理解每个渲染管线的功能，从而能在 Unity 中满怀信心地使用合适的光照设置让您项目大放异彩！</p>

<p>可通过以下文章来详细了解 Unity 中的光照和渲染管线：</p>

<ul>
<li><a href="https://unity3d.com/learn/tutorials/topics/graphics/introduction-lighting-and-rendering?playlist=17102">光照与渲染简介 (Introduction to Lighting and Rendering) 教程</a></li>
<li><a href="https://docs.unity3d.com/Manual/ProjectTemplates.html">通过 Unity Hub 开始使用 HDRP、LWRP 或内置 RP</a></li>
<li><a href="https://unity3d.com/learn/tutorials/s/creating-believable-visuals">创建逼真视觉效果 (Creating Believable Visuals) 教程（内置 RP）</a></li>
<li><a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/wiki/Lightweight-Render-Pipeline">GitHub 上的轻量级渲染管线 (Lightweight Render Pipeline)</a></li>
<li><a href="https://github.com/Unity-Technologies/ScriptableRenderPipeline/wiki/High-Definition-Render-Pipeline-overview">GitHub 上的高清渲染管线 (High-Definition Render Pipeline)</a></li>
</ul>

<hr>

<ul>
<li><span class="page-edit">2018–08–17页面已发布但未经<a href="DocumentationEditorialReview.html">编辑审查</a>
</span></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="BestPracticeMakingBelievableVisuals9.html"></a></span><div class="tip">动态光照</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="ExpertGuides.html"></a></span><div class="tip">专家指南</div>
</div>
</div>
</div>
<div class="footer-wrapper">
<div class="footer clear">
<div class="copy">版权所有 © 2019 Unity Technologies. Publication 2018.4</div>
<div class="menu">
<a href="https://unity3d.com/learn">教程</a><a href="https://answers.unity3d.com">社区答案</a><a href="https://support.unity3d.com/hc/en-us">知识库</a><a href="https://forum.unity3d.com">论坛</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div>
<div></div>
</div>
</div></div></div>
</div>
</body>
</html>
